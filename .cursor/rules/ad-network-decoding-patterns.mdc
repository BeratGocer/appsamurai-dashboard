---
description: Ad network decoding implementation patterns and troubleshooting
---

# Ad Network Decoding Patterns

## Core Architecture
The ad network decoding system uses [Adnetworks.csv](mdc:Adnetworks.csv) as the source of truth for publisher mappings and [src/utils/csvParser.ts](mdc:src/utils/csvParser.ts) for implementation.

## Decoding Functions
- **`decodeAdNetwork()`**: Decodes campaign_network (B column) 
- **`decodePublisherCode()`**: Decodes adgroup_network (C column)

## Key Patterns

### Prefix-Based Decoding
```typescript
// Special cases for common prefixes
if (cleanCode.startsWith('SFT_')) return 'Fluent';
if (cleanCode.startsWith('SIE_')) return 'Influence Mobile';
if (cleanCode.startsWith('dX')) return 'Influence Mobile';
if (cleanCode.startsWith('MT')) return 'Fluent';
```

### Base64 Decoding
Many codes are Base64 encoded:
- `MTg2Njl8` → Base64 decode → `18669|` → `MT` (Fluent) + `cc`
- `dXhVZFNTSlBtVUFq` → Base64 decode → Influence Mobile identifier

### Adnetworks.csv Structure
```csv
PREFIX,PUBLISHER_NAME
SFT,Fluent
SIE,Influence Mobile
MT,Fluent
dX,Influence Mobile
```

## Common Issues and Solutions

### Issue: "Unknown" publisher in dashboard
**Root Cause**: New ad network code not in mapping
**Solution**: 
1. Check [Adnetworks.csv](mdc:Adnetworks.csv) for existing prefix
2. Add new mapping if needed
3. Update both `decodeAdNetwork()` and `decodePublisherCode()` functions

### Issue: Base64 codes not decoding
**Root Cause**: Code looks like Base64 but isn't standard format
**Solution**: 
1. Try `atob()` decoding
2. Check if result makes sense (alphanumeric + common chars)
3. Add to mapping if valid

### Issue: Prefix conflicts
**Root Cause**: Multiple prefixes map to same publisher
**Solution**: Use most specific prefix first in special cases

## Testing New Codes
When adding new ad network codes:
1. Test with `node -e "console.log(atob('CODE'))"` for Base64
2. Check CSV data for usage patterns
3. Verify both campaign_network and adgroup_network decoding
4. Test in dashboard to ensure proper grouping

## Critical Rules
- ✅ Always check [Adnetworks.csv](mdc:Adnetworks.csv) first
- ✅ Add special cases for common prefixes
- ✅ Test Base64 decoding before adding mappings
- ✅ Update both decoding functions consistently
- ✅ Verify publisher grouping works in dashboard